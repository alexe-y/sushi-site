!function(t){"use strict";var e,a,r="",n=0,c=!1,o=t('<div class="jqcart-cart-label"><span class="jqcart-title"><i class="fas fa-shopping-basket"></i></span><span class="jqcart-total-cnt">x</span></div>'),i={buttons:".add_item",cartLabel:"body",visibleLabel:!1,openByAdding:!1,handler:"/",currency:"$"},l={init:function(a){if(i=t.extend(i,a),null!==(e=l.getStorage())&&Object.keys(e).length){for(var r in e)e.hasOwnProperty(r)&&(n+=e[r].count);c=!0}return o.prependTo(i.cartLabel)[c||i.visibleLabel?"show":"hide"]().on("click",l.openCart).find(".jqcart-total-cnt").text(n),t(document).on("click",i.buttons,l.addToCart).on("click",".jqcart-layout",function(t){t.target===this&&l.hideCart()}).on("click",".jqcart-incr",l.changeAmount).on("input keyup",".jqcart-amount",l.changeAmount).on("click",".jqcart-del-item",l.delFromCart).on("submit",".jqcart-orderform",l.sendOrder).on("reset",".jqcart-orderform",l.hideCart).on("click",".jqcart-print-order",l.printOrder),!1},addToCart:function(r){return r.preventDefault(),void 0===(a=t(this).data()).id?(console.log("Отсутствует ID товара"),!1):((e=l.getStorage()||{}).hasOwnProperty(a.id)?e[a.id].count++:(a.count=1,e[a.id]=a),l.setStorage(e),l.changeTotalCnt(1),o.show(),i.openByAdding&&l.openCart(),!1)},delFromCart:function(){var a=t(this).closest(".jqcart-tr"),r=a.data("id");return e=l.getStorage(),l.changeTotalCnt(-e[r].count),delete e[r],l.setStorage(e),a.remove(),l.recalcSum(),!1},changeAmount:function(){var a=t(this),r=a.hasClass("jqcart-amount"),n=+(r?a.val():a.data("incr")),c=a.closest(".jqcart-tr").data("id");return e=l.getStorage(),r?e[c].count=isNaN(n)||n<1?1:n:e[c].count+=n,e[c].count<1&&(e[c].count=1),r?a.val(e[c].count):a.siblings("input").val(e[c].count),l.setStorage(e),l.recalcSum(),!1},recalcSum:function(){var e,a=0,r=0,n=0;return t(".jqcart-tr").each(function(){e=+t(".jqcart-amount",this).val(),r=Math.ceil(e*t(".jqcart-price",this).text()*100)/100,t(".jqcart-sum",this).html(r+" "+i.currency),a=Math.ceil(100*(a+r))/100,n+=e}),t(".jqcart-subtotal span").text(a),t(".jqcart-total-cnt").text(n),n<=0&&(l.hideCart(),i.visibleLabel||o.hide()),!1},changeTotalCnt:function(e){var a=t(".jqcart-total-cnt");return a.text(+a.text()+e),!1},openCart:function(){var a,n=0;e=l.getStorage(),r=' <p class="modal-title">Корзина</p> ';var c,o=0;for(c in e)0,e.hasOwnProperty(c)&&(o=Math.ceil(e[c].count*e[c].price*100)/100,n=Math.ceil(100*(n+o))/100,r+=' <div class="tovar jqcart-tr" data-id="'+e[c].id+'">',r+='<div class="tovar-num">'+e[c].id+"</div>",r+=' <div class="tovar-name">'+e[c].title+"</div>",r+='<div class="tovar-price jqcart-price">'+e[c].price+i.currency+"</div>",r+=' <div class="tover-cencel"><span class="jqcart-del-item">x</span></div>',r+="</div>");r+='<div class="total-price jqcart-subtotal"><p>Total: <span>'+n+"</span> "+i.currency+"</p></div>",a=n?r+'<p class="jqcart-cart-title">Контактная информация:</p><form class="jqcart-orderform"><p><label>ФИО:</label><input type="text" name="user_name"></p><p><label>Телефон:</label><input type="text" name="user_phone"></p><p><label>Email:</label><input type="text" name="user_mail"></p><p><label>Адрес:</label><input type="text" name="user_address"></p><p><label>Коментарий:</label><textarea name="user_comment"></textarea></p><p><input type="submit" value="Отправить заказ"><input type="reset" value="Вернуться к покупкам"></p></form>':'<h2 class="jqcart-empty-cart">Корзина пуста</h2>',t('<div id="overlay"></div><div id="modal_form" class="jqcart-layout" ><div class="containerTovar jqcart-checkout"></div></div>').appendTo("body").find(".jqcart-checkout").html(a)},hideCart:function(){return t(".jqcart-layout, #overlay").fadeOut("fast",function(){t(this).remove()}),!1},sendOrder:function(e){e.preventDefault();var a=t(this);if(""===t.trim(t("[name=user_name]",a).val())||""===t.trim(t("[name=user_phone]",a).val()))return t('<p class="jqcart-error">Пожалуйста, укажите свое имя и контактный телефон!</p>').insertBefore(a).delay(3e3).fadeOut(),!1;t.ajax({url:i.handler,type:"POST",dataType:"json",data:{orderlist:t.param(l.getStorage()),userdata:a.serialize()},error:function(){},success:function(e){t(".jqcart-checkout").html("<p>"+e.message+"</p>"),e.errors||setTimeout(s.clearCart,2e3)}})},printOrder:function(){var e=t(this).closest(".jqcart-checkout").prop("outerHTML");if(!e)return!1;var a=window.open("","Печать заказа","width="+screen.width+",height="+screen.height),r=t(a.opener.document).find('link[href$="jqcart.css"]').attr("href"),n=new Date,c=("0"+n.getDate()).slice(-2)+"-"+("0"+(n.getMonth()+1)).slice(-2)+"-"+n.getFullYear()+" "+("0"+n.getHours()).slice(-2)+":"+("0"+n.getMinutes()).slice(-2)+":"+("0"+n.getSeconds()).slice(-2);return a.document.write("<html><head><title>Заказ "+c+"</title>"),a.document.write('<link rel="stylesheet" href="'+r+'" type="text/css" />'),a.document.write("</head><body >"),a.document.write(e),a.document.write("</body></html>"),setTimeout(function(){a.document.close(),a.focus(),a.print(),a.close()},100),!0},setStorage:function(t){return localStorage.setItem("jqcart",JSON.stringify(t)),!1},getStorage:function(){return JSON.parse(localStorage.getItem("jqcart"))}},s={clearCart:function(){localStorage.removeItem("jqcart"),o[i.visibleLabel?"show":"hide"]().find(".jqcart-total-cnt").text(0),l.hideCart()},openCart:l.openCart,printOrder:l.printOrder,test:function(){l.getStorage()}};t.jqCart=function(e){return s[e]?s[e].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?void t.error('Метод с именем "'+e+'" не существует!'):l.init.apply(this,arguments)}}(jQuery);